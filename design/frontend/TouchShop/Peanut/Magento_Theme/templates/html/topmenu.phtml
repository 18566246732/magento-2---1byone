<?php
/**
 * Copyright Â© Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */

// @codingStandardsIgnoreFile

?>
<?php
/**
 * Top menu for store
 *
 * @var $block \TouchShop\Touch1byone\Plugin\Block\Topmenu
 */

$topmenus = $block->getTopMenus();


?>
<?php $columnsLimit = $block->getColumnsLimit() ?: 0; ?>
<?php $_menu = $block->getHtml('level-top', 'submenu', $columnsLimit) ?>

<link rel="stylesheet" href="<?php echo $block->getViewFileUrl("Magento_Theme::css/topmenu.css") ?>">

<nav class="navigation" data-action="navigation">
    <ul class="top-menu">
        <?php foreach ($topmenus as $menu): ?>
            <div class="top-menu-wrapper">
                <li><a href="<?= $menu['url'] ?>"><?= $menu['label'] ?></a></li>
                <div class="menu-info">
                    <div class="submenu">
                        <?php foreach ($menu['submenus'] as $submenuGroup): ?>
                            <ul>
                                <?php foreach ($submenuGroup as $submenu): ?>
                                    <li data-src="<?= $submenu['image_url'] ?>"><a
                                                href="<?= $submenu['url'] ?>"><?= $submenu['label'] ?></a></li>
                                <?php endforeach; ?>
                            </ul>
                        <?php endforeach; ?>
                    </div>

                    <div class="menu-image" style="background-image: url('<?= $menu['image_url'] ?>')">
                    </div>

                    <?php if (isset($menu['additions'])): ?>
                    <div class="Brand-container">
                        <div class="Brand-title">Brand</div>
                        <div class="Brand-content">
                                <?php foreach ($menu['additions'] as $brand): ?>
                                    <a href="<?= $brand['url'] ?>"><?= $brand['label'] ?></a>
                                <?php endforeach; ?>
                        </div>
                    </div>
                    <?php endif; ?>
                </div>
            </div>
        <?php endforeach; ?>
    </ul>
    <div class="menu-info-cover"></div>
</nav>


<script>
    var topMenuIsHoverd = false;

    (function () {
        require(['jquery', 'jquery/ui'], function ($) {
            $(document).ready(function () {
                    var li = $("nav>ul li");
                    var menuInfo = $('.menu-info');
                    var topMenuItem = $(".top-menu-wrapper > li");
                    var sections = $(".sections");
                    var menuInfoCover = $(".menu-info-cover");
                    var navigation = $("nav.navigation");
                    var isHoverd = false;
                    var submenu = $(".submenu ul li");
                    var menuImg = $(".menu-image");
                    var topmenu = $(".top-menu li a");
                    li.on({
                        mouseover: function (e) {
                            if ($(this).children("ul").length != 0) {
                                $(this).children("ul").css({"display": "block"});
                            }
                        },
                        mouseout: function (e) {
                            $(this).children("ul").css("display", "none");
                        }
                    });

                    // console.log($(".navigation ul li"));
                    menuInfoCover.hide();
                    // A-->B
                    topMenuItem.on({
                        mouseover: function (e) {
                            // $(this).css("color", "#8d131c");
                            if ($(this).parent().find(".submenu ul").children().length) {
                                topMenuIsHoverd = true;
                                topmenu.addClass("nav-background-grey");
                                sections.css({
                                    "background-color": "rgba(255, 255, 255, 0.95)",
                                    "border-bottom": "1px solid grey"
                                });
                                menuInfo.removeClass("active");
                                menuInfoCover.css("display", "block");
                                // menuInfoCover.animate({"display": "block","height": "270px"}, 500);
                                $(this).next().addClass("active");
                            } else {
                                topMenuIsHoverd = false;
                                sections.css("border-bottom", "none");
                                if ($(document).scrollTop() <= 30) {
                                    topmenu.removeClass("nav-background-grey");
                                    sections.css("background-color", "rgba(255,255,255, 0)");
                                }
                                menuInfoCover.css("display", "none");

                                // menuInfoCover.animate({"display": "none","height": "0"}, 500);
                                menuInfo.removeClass("active");
                            }
                        }
                    });
                    // B-->A
                    menuInfoCover.on({
                        mouseleave: function (e) {
                            setTimeout(function () {
                                if (!isHoverd) {

                                    topMenuIsHoverd = false;
                                    sections.css("border-bottom", "none");
                                    if ($(document).scrollTop() <= 30) {
                                        topmenu.removeClass("nav-background-grey");
                                        sections.css("background-color", "rgba(255,255,255, 0)");
                                    }
                                    menuInfoCover.css("display", "none");
                                    menuInfo.removeClass("active");
                                }
                            }, 1);
                        }
                    })
                    menuInfo.hover(function () {
                        isHoverd = true;
                    }, function () {
                        isHoverd = false;
                    });

                    submenu.hover(function () {
                        menuImg.css("background-image", "url(" + $(this).attr("data-src") + ")");
                    });


                }
            )
        })
    })()
</script>
