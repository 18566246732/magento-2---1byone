<?php
/** @var TouchShop\PowerUser\Block\PowerUser $block */

?>
<link rel="stylesheet" type="text/css"
      href="<?php echo $block->getViewFileUrl("TouchShop_Basic::css/common.css") ?>">
<link rel="stylesheet" type="text/css"
      href="<?php echo $block->getViewFileUrl("TouchShop_PowerUser::css/PowerUser.css") ?>">
<div class="blank"></div>
<div class="power-user-banner">
    <img src="<?php echo $block->getBaseImgUrl('banner_superuser.jpg') ?>" alt="">
</div>
<form action="<?php echo $block->getFormAction() ?>" method="post" class="power-user-form">
    <div class="input-container-title">We'd love to learn more about you so that we can offer products that are most
        relaevant to your interests.
    </div>
    <div class="input-container">
        <label for="email">I am interested in:</label>
        <div class="input-container input-container-full">
            <div class="input-checkbox-container">
                <div><input type="checkbox" name="interests[]" value="TV Accessories"> TV Accessories</div>
                <div><input type="checkbox" name="interests[]" value="Home Decoration"> Home Decoration</div>
                <div><input type="checkbox" name="interests[]" value="Stage Lighting & Effects"> Stage Lighting & Effects</div>
                <div><input type="checkbox" name="interests[]" value="Home Security"> Home Security</div>
                <div><input type="checkbox" name="interests[]" value="Accessories"> Accessories</div>
                <div><input type="checkbox" name="interests[]" value="Power"> Power</div>
                <div><input type="checkbox" name="interests[]" value="Healths"> Health</div>
                <div><input type="checkbox" name="interests[]" value="Audio & Sounds"> Audio & Sounds</div>
            </div>
        </div>
    </div>

    <div class="input-container-title input-container-title-noBold">The fields marked <span>*</span> are required.</div>
    <div class="input-container-title">Power User Information</div>

    <div class="input-container">
        <div class="form-action-control-container">
            <div class="control1">
                <label for="text">Email address <span>*</span>
                    <input name="email" id="powerUserEmail" type="email" required="required" autocomplete="off">
                </label>
            </div>
            <div class="power-user-hint"></div>

            <div class="power-user-pwd1">
                <label for="password">Password <span>*</span>
                    <input name="password" id="powerUserPwd1" type="password" required="required" autocomplete="off">
                </label>
            </div>

            <div class="power-user-pwd2">
                <label for="password">Please enter your Password again<span>*</span>
                    <input name="password" id="powerUserPwd2" type="password" required="required" autocomplete="off">
                </label>
            </div>

            <div class="form-action-btn">
                <button type="button">SUBMIT</button>
            </div>
        </div>
    </div>
</form>


<script>
    (function () {
        require(['jquery', 'ajax', 'bindQuickAutoLogin'], function ($, ajax, bindQuickAutoLogin) {
            let data = <?= $block->getAjax()?>;
            let inputCheckBox = $(".input-checkbox-container input");
            let hint = $(".power-user-hint");
            hint.text(sessionStorage.getItem("success") || '').css("color", "blue");
            if(data.vip == 2) {
                // interests
                inputCheckBox.each(function (index, e) {
                    if (data.interests.indexOf($(e).val()) != -1) {
                        $(e).attr("checked", "checked");
                    }
                });
            }
            bindQuickAutoLogin.bind(
                data,    //data
                "<?= $block->getBaseUrl()?>", //baseUrl
                $("#powerUserEmail"),   //email
                $(".form-action-control-container .power-user-pwd1"),   //userPwd1Con
                $(".form-action-control-container .power-user-pwd2"),   //userPwd2Con
                $("#powerUserPwd1"),    //userPwd1
                $("#powerUserPwd2"),    //userPwd2
                $(".form-action-control-container input"),  //formActionInput
                $(".form-action-btn button[type='button']"),    //submitBtn
                hint,  //hint
                submitForm  //submitFormFunc
            );

            function submitForm(email, customerId) {
                let result = false;
                let url = "<?= $block->getFormAction()?>";
                let interestsArr = [];
                let inputCheckedContainer = $(".input-checkbox-container input:checked");
                inputCheckedContainer.each(function (index, e) {
                    interestsArr.push(e.value);
                });
                let param = {
                    email: email,
                    customerId: customerId,
                    interests: interestsArr
                };
                ajax.sendAjax(false, url, param, function (res) {
                    console.log("form submit", res);
                    if (res.status_code == 200) {
                        result = true;
                    } else {
                        hint.text(res.error_message);
                    }
                });
                return result;
            }
        })
    })();
</script>
