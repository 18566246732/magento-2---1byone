<?php
/** @var TouchShop\Basic\Block\CarouselBasic $block */
?>

<link rel="stylesheet" type="text/css"
      href="<?php echo $block->getViewFileUrl('TouchShop_Basic::css/owl.carousel.min.css') ?>">
<link rel="stylesheet" href="<?php echo $block->getViewFileUrl("TouchShop_Basic::css/owl-overwrite.css")?>">

<div class="owl-carousel-container">
    <div class="owl-carousel owl-theme">
        <?php foreach ($block->getImages() as $name => $image): ?>
            <div style="cursor: pointer" class="item" onclick="toView('<?php echo $image["url"] ?>')">
                <img style="max-height: 998px" src="<?php echo $image["src"]; ?>"/>
                <span data-color="<?php echo $image["text-color"]?>" style="display: none"></span>
                <div class="owl-img-addon">`
                    <h1><?= $image['title']?></h1>
                    <p><?= $image['subtitle']?></p>
                    <button>GET NOW</button>
                </div>
            </div>
        <?php endforeach; ?>
    </div>
</div>

<script>
    function toView(params) {
        window.open(params)
    }
    (function () {
        require(["jquery", "owlcarousel"], function ($) {
            $(document).ready(function () {
                $(".owl-carousel").css("visibility", "hidden");
                var owl = $('.owl-carousel').owlCarousel({
                    loop: true,
                    margin: 10,
                    autoplay: true,
                    nav: false,
                    items: 1,
                    dots: true,
                    lazyEffect: true,
                    // dotsEach: true,
                });

                var allSpan = $(".owl-carousel.owl-theme span"),
                    spanArr = allSpan.slice(2,6),
                    navText = $(".top-menu li a"),
                    owlImgNum = allSpan.length - 7 ,
                    owlAddOn = $(".owl-img-addon");

                owlAddOn.each(function (index, e) {
                    $(e).css("color", spanArr[(index + 1) % owlImgNum].getAttribute("data-color"));
                })

                    // change color every switch
                console.log("owlImgNum:", owlImgNum);
                owl.on("initialized.owl.carousel changed.owl.carousel", function (e) {
                    var index = e.relatedTarget.current();

                    // navText.each(function (ep, e) {
                    //     e.style.color = spanArr[(index-2) % owlImgNum].getAttribute("data-color");
                    // })

                    navText.css("color", spanArr[(index-2) % owlImgNum].getAttribute("data-color"));
                    $(".owl-dot > span").css("background-image", "none");
                    $(".owl-dot.active > span").css("background-image", "url('<?php echo $block->getBaseUrl() . 'pub/media/wysiwyg/logo_dot.png'?>')");
                });

                <?php if ($block->isFullScreen()): ?>
                function resizeCarouselContainer() {
                    var WINDOW_WIDTH = document.body.offsetWidth
                    var TARGET_WIDTH = $('.page-main').width()
                    $('.owl-carousel-container, .imgs-gallery').width(WINDOW_WIDTH)
                    $('.owl-carousel-container, .imgs-gallery').css('margin-left', -((WINDOW_WIDTH - TARGET_WIDTH) / 2) + 'px')
                }

                resizeCarouselContainer()

                owl.on("refresh.owl.carousel", function () {
                    var timeout = setTimeout(function () {
                        owl.css("visibility", "visible");
                    },500);
                });

                $('.owl-carousel').owlCarousel('refresh');

                window.addEventListener('resize', function () {
                    resizeCarouselContainer()
                });
                <?php endif; ?>

                $(".owl-dot > span").css("background-image", "none");
                $(".owl-dot.active > span").css("background-image", "url('<?php echo $block->getBaseUrl() . 'pub/media/wysiwyg/logo_dot.png'?>')")
            });
        });
    })();
</script>