<?php
/** @var TouchShop\Touch1byone\Block\User $block */
//?>

<?php
///**
// * Copyright © Magento, Inc. All rights reserved.
// * See COPYING.txt for license details.
// */
//
//// @codingStandardsIgnoreFile
//
///** @var \Magento\Customer\Block\Form\Register $block */
//?>


<link rel="stylesheet" href="<?php echo $block->getViewFileUrl("TouchShop_Touch1byone::css/user.css") ?>">

<div class="user">
    <div class="user-icon">
        <img src="<?php echo $block->getBaseUrl() . 'pub/media/wysiwyg/user.png' ?> " alt="">
    </div>

    <div class="user-submenu">
        <ul>
            <li><a href="<?php echo $block->getBaseUrl() . "customer/account/"?>">Account Info</a></li>
            <li><a href="<?php echo $block->getBaseUrl() . "customer/account/logout"?>">Log out</a></li>
        </ul>
    </div>
</div>


<!--login popup-->


<div class="login-back">

    <div class="sign-panel sign-in">
        <span class="close-btn">x</span>
        <?php echo $block->getLayout()->createBlock("Magento\Customer\Block\Form\Login")->setTemplate("TouchShop_Touch1byone::login.phtml")->toHtml(); ?>
    </div>

    <div class="sign-panel sign-up">
        <span class="close-btn">x</span>
        <?php echo $block->getLayout()->createBlock("Magento\Customer\Block\Form\Register")->setTemplate("TouchShop_Touch1byone::register.phtml")->toHtml(); ?>
    </div>

</div>


<script>
    (function () {
        require(['jquery', 'jquery/ui'], function ($) {
            var signUp = $("#signUp"),
                signIn = $("#signIn"),
                signUpPanel = $(".sign-up"),
                signInPanel = $(".sign-in");

            <?php if ($block->hasLogin()):?>

            $(".user").on({
                mouseover: function () {
                    $(".user-submenu").css("display", "block");
                    $("#searchBtn pseudo").css("color", "#817a7a");
                },
                mouseout: function () {
                    $(".user-submenu").css("display", "none");
                }
            });

            <?php else:?>

            $(".user-icon").on("click", function () {
                $(".login-back").css("display", "block");
            });

            $(".close-btn").on("click", function () {
                $(".login-back").css("display", "none");
            });

            signIn.on("click", function () {
                signUpPanel.css("display", "none");
                signInPanel.css("display", "flex");
            });

            signUp.on("click", function () {
                signInPanel.css("display", "none");
                signUpPanel.css("display", "flex");
            });
            <?php endif;?>
        })

    })()
</script>

<script>
    (function () {
        const addCookie = function (name, value, expiresHours) {
            var cookieString = name + "=" + escape(value);
            //判断是否设置过期时间
            if (expiresHours > 0) {
                var date = new Date();
                date.setTime(date.getTime + expiresHours * 3600 * 1000);
                cookieString = cookieString + "; expires=" + date.toGMTString();
            }
            document.cookie = cookieString;
        }
        addCookie("login_redirect", location.href, 1);
    })()
</script>